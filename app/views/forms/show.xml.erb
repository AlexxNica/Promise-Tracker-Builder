<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa">
  <h:head>
    <h:title><%= @form.title %></h:title>
    <model>
      <instance>
        <data id="<%= @form.guid %>">
          <meta>
            <instanceID/>
          </meta>
          <% @form.inputs.each do |input| %>
            <<%= input.guid %>/>
          <% end %>
        </data>
      </instance>
      <itext>
        <translation lang="eng">
        <% @form.inputs.each do |input| %>
          <text id="/data/<%= input.guid %>:label">
            <value><%= input.label %></value>
          </text>  

          <% if input.options %>
          <% input.options.values.each_with_index do |label, index| %>
            <text id="/data/<%= input.guid %>:option<%= index %>">
              <value><%= label %></value>
            </text>
          <% end %> 
          <% end %>  
        <% end %>
        </translation>
      </itext>
      <bind nodeset="/data/meta/instanceID" type="string" readonly="true()" calculate="concat('uuid:', uuid())"/>
      <% @form.inputs.each do |input| %>
        <bind nodeset="/data/<%= input.guid %>" type="<%= input.input_type %>" <% if input.required %>required="true()"<% end %>/>
      <% end %>
    </model>
  </h:head>
  <h:body>
    <% @form.inputs.each do |input| %>
      <!-- For uploads -->
      <% case input.input_type
        when "binary" %>
      <upload ref="/data/<%= input.guid %>" mediatype="<%= input.media_type %>">
        <label ref="jr:itext('/data/<%= input.guid %>:label')"/>
      </upload>

      <!-- For select1 -->
      <% when "select1"%>
      <select1 ref="/data/<%= input.guid %>">
        <label ref="jr:itext('/data/<%= input.guid %>:label')"/>
        <% if input.options %>
        <% input.options.keys.each_with_index do |key, index| %>
        <item>
          <label ref="jr:itext('/data/<%= input.guid %>:option<%= index %>')"></label>
          <value><%= key %></value>
        </item>  
        <% end %>
        <% end %>
      </select1>

      <!-- For select many -->
      <% when "select"%>
      <select ref="/data/<%= input.guid %>">
        <label ref="jr:itext('/data/<%= input.guid %>:label')"/>
        <% if input.options %>
        <% input.options.keys.each_with_index do |key, index| %>
        <item>
          <label ref="jr:itext('/data/<%= input.guid %>:option<%= index %>')"></label>
          <value><%= key %></value>
        </item>  
        <% end %>
        <% end %>
      </select>

      <!-- For text/numeric -->  
      <% else %>
      <input ref="/data/<%= input.guid %>">
        <label ref="jr:itext('/data/<%= input.guid %>:label')"/>
      </input>
      <% end %>
    <% end %> 
  </h:body>
</h:html>